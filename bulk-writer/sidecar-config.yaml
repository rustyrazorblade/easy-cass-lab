#
# Cassandra Sidecar configuration for local Docker testing
# Sidecar shares network with Cassandra, so uses localhost for internal connections
#

cassandra_instances:
  - id: 1
    host: 10.99.0.2
    port: 9042
    username:
    password:
    data_dirs:
      - /var/lib/cassandra/data
    commitlog_dir: /var/lib/cassandra/commitlog
    hints_dir: /var/lib/cassandra/hints
    saved_caches_dir: /var/lib/cassandra/saved_caches
    staging_dir: /var/lib/cassandra/staging
    jmx_host: 127.0.0.1
    jmx_port: 7199
    jmx_ssl_enabled: false

sidecar:
  host: 0.0.0.0
  port: 9043
  request_idle_timeout_millis: 300000
  request_timeout_millis: 300000
  tcp_keep_alive: false
  accept_backlog: 1024
  server_verticle_instances: 1
  throttle:
    stream_requests_per_sec: 5000
    delay_sec: 5
    timeout_sec: 10
  traffic_shaping:
    inbound_global_bandwidth_bps: 0
    outbound_global_bandwidth_bps: 0
    peak_outbound_global_bandwidth_bps: 419430400
    max_delay_to_wait_millis: 15000
    check_interval_for_stats_millis: 1000
    inbound_global_file_bandwidth_bps: 0
  sstable_upload:
    concurrent_upload_limit: 80
    min_free_space_percent: 10
  allowable_time_skew_in_minutes: 60
  sstable_import:
    poll_interval_millis: 100
    cache:
      expire_after_access_millis: 7200000
      maximum_size: 10000
  worker_pools:
    service:
      name: "sidecar-worker-pool"
      size: 20
      max_execution_time_millis: 60000
    internal:
      name: "sidecar-internal-worker-pool"
      size: 20
      max_execution_time_millis: 900000
  jmx:
    max_retries: 3
    retry_delay_millis: 200
  schema:
    is_enabled: true
    keyspace: sidecar_internal
    replication_strategy: SimpleStrategy
    replication_factor: 1

driver_parameters:
  contact_points:
    - "10.99.0.2:9042"
  num_connections: 6
  local_dc: dc1

healthcheck:
  initial_delay_millis: 0
  poll_freq_millis: 30000

cassandra_input_validation:
  forbidden_keyspaces:
    - system_schema
    - system_traces
    - system_distributed
    - system
    - system_auth
    - system_views
    - system_virtual_schema
  allowed_chars_for_directory: "[a-zA-Z][a-zA-Z0-9_]{0,47}"
  allowed_chars_for_quoted_name: "[a-zA-Z_0-9]{1,48}"
  allowed_chars_for_component_name: "[a-zA-Z0-9_-]+(.db|.cql|.json|.crc32|TOC.txt)"
  allowed_chars_for_restricted_component_name: "[a-zA-Z0-9_-]+(.db|TOC.txt)"

blob_restore:
  job_discovery_active_loop_delay_millis: 5
  job_discovery_idle_loop_delay_millis: 10
  job_discovery_recency_days: 5
  slice_process_max_concurrency: 20
  restore_job_tables_ttl_seconds: 7776000

s3_client:
  concurrency: 4
  thread_name_prefix: s3-client
  thread_keep_alive_seconds: 60
