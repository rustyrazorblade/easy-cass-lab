#!/bin/bash

set -e  # Exit on any error

echo "=== Building project ==="
./gradlew clean test shadowJar installDist

echo "=== Initializing cluster ==="
bin/easy-cass-lab init -c 2 -i t3a.xlarge test --clean --up

echo "=== Updating configuration ==="
bin/easy-cass-lab update-config

echo "=== Listing available Cassandra versions ==="
bin/easy-cass-lab list

echo "=== Setting Cassandra version to 5.0 ==="
bin/easy-cass-lab use 5.0

echo "=== Starting Cassandra ==="
bin/easy-cass-lab start

echo "=== Restarting Cassandra ==="
bin/easy-cass-lab restart

echo "=== Testing exec command (sequential) ==="
bin/easy-cass-lab exec -t cassandra hostname

echo "=== Testing exec command (parallel) ==="
bin/easy-cass-lab exec -t cassandra -p uptime

echo "=== Testing exec command (with host filter) ==="
bin/easy-cass-lab exec -t cassandra --hosts cassandra0,cassandra1 date

echo "=== Tearing down cluster ==="
bin/easy-cass-lab down --yes

echo "=== End-to-end test completed successfully ==="


